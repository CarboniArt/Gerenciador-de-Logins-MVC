<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Gerenciador de Contas</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
    <div class="container">
        <div class="header-container">
            <div>
                <h1>Gerenciador de Contas</h1>
                <div class="counter">Total de contas: {{ contas|length }}</div>
            </div>
            <button class="theme-toggle" id="themeToggle">üåì</button>
        </div>

        {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
        {% for category, message in messages %}
        <div class="flash {{ category }}">{{ message }}</div>
        {% endfor %}
        {% endif %}
        {% endwith %}

        <div class="search-container">
            <form method="POST" action="{{ url_for('conta_bp.index') }}" style="flex-grow: 1; display: flex; gap: 12px;">
                <input type="text" name="search" placeholder="Buscar por email ou observa√ß√£o" value="{{ search }}">
                <input type="submit" value="Buscar" class="btn btn-primary">
            </form>
            <div style="display:flex; gap:12px;">
                <a href="{{ url_for('conta_bp.adicionar') }}" class="btn btn-primary">Adicionar Nova Conta</a>
                <a href="{{ url_for('conta_bp.exportar') }}" class="btn btn-secondary">Exportar TXT</a>
            </div>
        </div>
        
        <div style="overflow-x: auto;">
            <table>
                <thead>
                    <tr>
                        <th style="width:25%;">Email</th>
                        <th style="width:15%;">Senha</th>
                        <th style="width:18%;">Provedor</th>
                        <th style="width:30%;">Observa√ß√µes</th>
                        <th style="width:12%;">A√ß√µes</th>
                    </tr>
                </thead>
                <tbody>
                    {% for conta in contas %}
                    <tr>
                        <td class="copyable" onclick="copyToClipboard(this, '{{ conta['email'] }}')">{{ conta['email'] }}</td>
                        <td class="copyable password" onclick="copyToClipboard(this, '{{ conta['senha'] }}')">{{ conta['senha'] }}</td>
                        <td>
                            {% if conta['provedor'] %}
                            <a href="{{ conta['provedor'] }}" target="_blank" class="provedor-link">Acessar</a>
                            {% endif %}
                        </td>
                        <td class="copyable" onclick="copyToClipboard(this, '{{ conta['observacoes'] }}')">{{ conta['observacoes'] }}</td>
                        <td>
                            <div style="display:flex; gap:8px; align-items:center;">
                                <a href="{{ url_for('conta_bp.editar', id=conta['id']) }}" class="action-btn" title="Editar">‚úèÔ∏è</a>
                                <form method="POST" action="{{ url_for('conta_bp.excluir', id=conta['id']) }}" style="margin:0;">
                                    <button type="submit" class="action-btn" title="Excluir">üóëÔ∏è</button>
                                </form>
                            </div>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>

    <script>
        function copyToClipboard(element, text) {
            navigator.clipboard.writeText(text || '').then(() => {
                const notification = document.createElement('div');
                notification.className = 'copy-notification';
                notification.textContent = 'Copiado!';
                element.style.position = 'relative';
                element.appendChild(notification);
                setTimeout(() => {
                    if (element.contains(notification)) element.removeChild(notification);
                }, 1000);
            });
        }

        const themeToggle = document.getElementById('themeToggle');
        const prefersDarkScheme = window.matchMedia('(prefers-color-scheme: dark)');
        const currentTheme = localStorage.getItem('theme') || (prefersDarkScheme.matches ? 'dark' : 'light');
        if (currentTheme === 'dark') {
            document.body.setAttribute('data-theme', 'dark');
            themeToggle.textContent = 'üåû';
        } else {
            document.body.removeAttribute('data-theme');
            themeToggle.textContent = 'üåô';
        }
        themeToggle.addEventListener('click', () => {
            if (document.body.getAttribute('data-theme') === 'dark') {
                document.body.removeAttribute('data-theme');
                localStorage.setItem('theme', 'light');
                themeToggle.textContent = 'üåô';
            } else {
                document.body.setAttribute('data-theme', 'dark');
                localStorage.setItem('theme', 'dark');
                themeToggle.textContent = 'üåû';
            }
        });

        document.querySelectorAll('form[action*="excluir"] button[type="submit"]').forEach(button => {
            button.addEventListener('click', (e) => {
                const row = button.closest('tr');
                const email = row ? row.querySelector('td')?.textContent.trim() : '';
                if (!confirm(`Tem certeza que deseja excluir esta conta?\n\nEmail: ${email}`)) {
                    e.preventDefault();
                }
            });
        });
    </script>
</body>
</html>
